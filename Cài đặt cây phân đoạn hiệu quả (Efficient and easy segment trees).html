<!DOCTYPE html>
<!-- saved from url=(0079)https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="MobileOptimized" content="width">
  <meta name="HandheldFriendly" content="true">
  <meta name="viewport" content="width=device-width">

  <!-- Make FB likes & comments from old http url available in new https url -->
  <meta property="og:url" content="http://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees">
  <link rel="stylesheet" type="text/css" href="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/app-b205e593a30f1cc0054e2e9ed9fc8af3658d8ef4a62b9708c20f204560deefb7.css" media="all">
  <link rel="stylesheet" type="text/css" href="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/print-512498c368be0d3fb1ba105dfa84289ae48380ec9fcbef948bd4e23b0b095bfb.css" media="print">

  <link rel="stylesheet" type="text/css" href="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/custom.css" media="all">
  


  <script src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/sdk.js.download" async="" crossorigin="anonymous"></script><script id="facebook-jssdk" src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/sdk.js(1).download"></script><script>
  var criticMarkup = '';
	var baseUrl = '/wiki';
	var uploadDest = 'uploads';
	var perPageUploads = '';
	if (perPageUploads == 'true') {
	  uploadDest = uploadDest + window.location.pathname.replace(/.*gollum\/[-\w]+\//, "/").replace(/\.[^/.]+$/, "").replace(baseUrl, "")
	}
	  var pageFullPath = 'translate/codeforces/Efficient-and-easy-segment-trees.md';
          var unescapedPath = 'translate/codeforces/Efficient-and-easy-segment-trees.md';
    var pageFormat   = 'markdown';

  </script>
  <script src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/app-3360f8faf2f9cd3020463278cdb5512b0109241647bbf55407e64ea11759572d.js.download" type="text/javascript"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {
        inlineMath:  [ ['$','$'], ['\\(','\\)'] ],
        displayMath: [ ['$$','$$'], ['\\[','\\]'] ],
        processEscapes: true
      },
      TeX: { extensions: ["autoload-all.js"] }
    };
  </script>
  <script type="text/javascript" src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/mathjax.config.js.download"></script>
  <script defer="" src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/MathJax.js.download"></script>
  

  <title>Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)</title>
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css" data-fbcssmodules="css:fb.css.basecss:fb.css.dialog css:fb.css.iframewidget">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none; box-sizing: content-box}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_test.mjx-test-display {display: table!important}
.MathJax_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_test.mjx-test-default {display: block!important; clear: both}
.MathJax_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.MathJax_em_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60em}
.mjx-test-inline .MathJax_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.5') format('woff'), url('https://vnoi.info/wiki/gollum/assets/mathjax/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.5') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body class="webkit"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
    <!-- FB like & comments -->
    <div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; width: 0px; height: 0px;"><div></div></div></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=449532395210446";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

<div class="container-lg clearfix">
<div id="wiki-wrapper" class="page">
<div id="head">
	<nav class="actions pt-4">
	
	<div class="TableObject">
		<div class="TableObject-item">
	    <a class="btn" href="https://vnoi.info/wiki/">Home</a>
	  </div>


  	<div class="TableObject-item TableObject-item--primary px-2">
			<form class="search-form" action="https://vnoi.info/wiki/gollum/search" method="get" id="search-form">
				<input type="text" class="form-control input-block" name="q" id="search-query" placeholder="Search" aria-label="Search site" autocomplete="off">
			</form>	  </div>
		
	  <div class="TableObject-item">
	    <a class="btn" href="https://vnoi.info/wiki/gollum/overview">Overview</a>
	  </div>
	
			
	</div>
</nav>

</div>

<div id="wiki-content">
	<h1 class="pt-4">Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)</h1>
	<div class="breadcrumb"><nav aria-label="Breadcrumb"><ol>
<li class="breadcrumb-item"><a href="https://vnoi.info/wiki/gollum/overview/translate/">translate</a></li>
<li class="breadcrumb-item"><a href="https://vnoi.info/wiki/gollum/overview/translate/codeforces/">codeforces</a></li>
</ol></nav></div>
	

	<div class="">
	  <div id="wiki-body" class="gollum-markdown-content overflow-hidden ">
	    <div class="markdown-body ">
	      
	      

<p dir="auto"><strong>Nguồn</strong>: <a href="http://codeforces.com/blog/entry/18051">Codeforces - Efficient and Easy Segment Tree</a></p>

<p dir="auto"></p><div class="toc"><div class="toc-title">Table of Contents</div><ul><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#c%E1%BA%ADp-nh%E1%BA%ADt-t%E1%BB%ABng-ph%E1%BA%A7n-t%E1%BB%AD-ri%C3%AAng-l%E1%BA%BB-single-element-modifications">Cập nhật từng phần tử riêng lẻ (single element modifications)</a><ul><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#c%C3%A2y-nh%E1%BB%8B-ph%C3%A2n-ho%C3%A0n-ch%E1%BB%89nh-perfect-binary-tree">Cây nhị phân hoàn chỉnh (Perfect binary tree)</a></li><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#m%E1%BA%A3ng-k%C3%ADch-th%C6%B0%E1%BB%9Bc-b%E1%BA%A5t-k%C3%AC-arbitrary-sized-array">Mảng kích thước bất kì (Arbitrary sized array)</a></li><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#ch%E1%BB%89nh-s%E1%BB%ADa-tr%C3%AAn-%C4%91o%E1%BA%A1n-truy-c%E1%BA%ADp-t%E1%BB%ABng-c%C3%A1c-ph%E1%BA%A7n-t%E1%BB%AD-l%E1%BA%BB-modification-on-interval-single-element-access">Chỉnh sửa trên đoạn, truy cập từng các phần tử lẻ (Modification on interval, single element access)</a></li><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#h%C3%A0m-k%E1%BA%BFt-h%E1%BB%A3p-kh%C3%B4ng-c%C3%B3-t%C3%ADnh-giao-ho%C3%A1n-non-commutative-combiner-functions">Hàm kết hợp không có tính giao hoán (Non-commutative combiner functions)</a></li></ul></li><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#c%E1%BA%ADp-nh%E1%BA%ADt-%C4%91o%E1%BA%A1n-lazy-propagation">Cập nhật đoạn (Lazy propagation)</a><ul><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#t%C4%83ng-gi%C3%A1-tr%E1%BB%8B-ph%E1%BA%A7n-t%E1%BB%AD-truy-v%E1%BA%A5n-t%C3%ACm-gi%C3%A1-tr%E1%BB%8B-max-increment-modifications-queries-for-maximum">Tăng giá trị phần tử, truy vấn tìm giá trị max (Increment modifications, queries for maximum)</a></li><li><a href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#g%C3%A1n-gi%C3%A1-tr%E1%BB%8B-m%E1%BB%9Bi-cho-ph%E1%BA%A7n-t%E1%BB%AD-truy-v%E1%BA%A5n-t%E1%BB%95ng-assignment-modifications-sum-queries">Gán giá trị mới cho phần tử, truy vấn tổng (Assignment modifications, sum queries)</a></li></ul></li></ul></div>

<p dir="auto">Hầu hết các bạn tham gia vào các cuộc thi lập trình đều khá quen thuộc với cây phân đoạn, chẳng hạn qua <a href="https://vnoi.info/wiki/translate/codeforces/algo/data-structures/segment-tree-extend">bài viết này</a>. Nếu chưa, bạn nên xem bài viết này trước, để so sánh cách thực hiện và chọn được cách tốt nhất cho mình.</p>

<h1 class="editable"><a class="anchor" id="cập-nhật-từng-phần-tử-riêng-lẻ-single-element-modifications" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#c%E1%BA%ADp-nh%E1%BA%ADt-t%E1%BB%ABng-ph%E1%BA%A7n-t%E1%BB%AD-ri%C3%AAng-l%E1%BA%BB-single-element-modifications"></a>Cập nhật từng phần tử riêng lẻ (single element modifications)<a class="anchor edit" id="cập-nhật-từng-phần-tử-riêng-lẻ-single-element-modifications" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#c%E1%BA%ADp-nh%E1%BA%ADt-t%E1%BB%ABng-ph%E1%BA%A7n-t%E1%BB%AD-ri%C3%AAng-l%E1%BA%BB-single-element-modifications"></a></h1>

<p dir="auto">Cây phân đoạn được sử dụng khi chúng ta có một mảng <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0.865em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.75em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.75em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math-italic;">A</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">A</script>, thực hiện các chỉnh sửa và truy vấn trên các đoạn liên tiếp. Ví dụ: ta có một mảng <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-4" style="width: 0.865em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.75em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.75em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-5"><span class="mi" id="MathJax-Span-6" style="font-family: MathJax_Math-italic;">A</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">A</script> với <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-7" style="width: 1.67em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.44em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.267em, 1001.44em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-8"><span class="msubsup" id="MathJax-Span-9"><span style="display: inline-block; position: relative; width: 1.44em; height: 0px;"><span style="position: absolute; clip: rect(3.164em, 1000.98em, 4.198em, -999.997em); top: -4.02em; left: 0em;"><span class="mn" id="MathJax-Span-10" style="font-family: MathJax_Main;">10</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span><span style="position: absolute; top: -4.422em; left: 0.98em;"><span class="mn" id="MathJax-Span-11" style="font-size: 70.7%; font-family: MathJax_Main;">5</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 1.137em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mn>5</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-3">10^5</script> phần tử và cần thực hiện <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-12" style="width: 0.98em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.807em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.75em, 2.647em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-13"><span class="mi" id="MathJax-Span-14" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.203em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">Q</script> thao tác, mỗi thao tác thuộc 1 trong 2 loại:</p>

<ol>
  <li>Thay đổi giá trị của một phần tử: Gán <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-15" style="width: 3.394em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.934em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.93em, 2.704em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-16"><span class="msubsup" id="MathJax-Span-17"><span style="display: inline-block; position: relative; width: 1.095em; height: 0px;"><span style="position: absolute; clip: rect(3.164em, 1000.75em, 4.198em, -999.997em); top: -4.02em; left: 0em;"><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.75em;"><span class="mi" id="MathJax-Span-19" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span></span></span><span class="mo" id="MathJax-Span-20" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mi" id="MathJax-Span-21" style="font-family: MathJax_Math-italic; padding-left: 0.29em;">v</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.137em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">A_i = v</script>.</li>
  <li>Tính tổng các phần tử trên đoạn bất kì: Tính <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-22" style="width: 10.463em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.026em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1009.03em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-23"><span class="msubsup" id="MathJax-Span-24"><span style="display: inline-block; position: relative; width: 1.037em; height: 0px;"><span style="position: absolute; clip: rect(3.164em, 1000.75em, 4.198em, -999.997em); top: -4.02em; left: 0em;"><span class="mi" id="MathJax-Span-25" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.75em;"><span class="mi" id="MathJax-Span-26" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span></span></span><span class="mo" id="MathJax-Span-27" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="msubsup" id="MathJax-Span-28" style="padding-left: 0.233em;"><span style="display: inline-block; position: relative; width: 1.957em; height: 0px;"><span style="position: absolute; clip: rect(3.164em, 1000.75em, 4.198em, -999.997em); top: -4.02em; left: 0em;"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.75em;"><span class="texatom" id="MathJax-Span-30"><span class="mrow" id="MathJax-Span-31"><span class="mi" id="MathJax-Span-32" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-33" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-34" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span></span></span><span class="mo" id="MathJax-Span-35" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main; padding-left: 0.233em;">…</span><span class="mo" id="MathJax-Span-37" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="msubsup" id="MathJax-Span-38" style="padding-left: 0.233em;"><span style="display: inline-block; position: relative; width: 1.152em; height: 0px;"><span style="position: absolute; clip: rect(3.164em, 1000.75em, 4.198em, -999.997em); top: -4.02em; left: 0em;"><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.75em;"><span class="mi" id="MathJax-Span-40" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.026em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.203em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mi>l</mi></msub><mo>+</mo><msub><mi>A</mi><mrow class="MJX-TeXAtom-ORD"><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>…</mo><mo>+</mo><msub><mi>A</mi><mi>r</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">A_l + A_{l+1} + … + A_r</script>.</li>
</ol>

<h2 class="editable"><a class="anchor" id="cây-nhị-phân-hoàn-chỉnh-perfect-binary-tree" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#c%C3%A2y-nh%E1%BB%8B-ph%C3%A2n-ho%C3%A0n-ch%E1%BB%89nh-perfect-binary-tree"></a>Cây nhị phân hoàn chỉnh (Perfect binary tree)<a class="anchor edit" id="cây-nhị-phân-hoàn-chỉnh-perfect-binary-tree" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#c%C3%A2y-nh%E1%BB%8B-ph%C3%A2n-ho%C3%A0n-ch%E1%BB%89nh-perfect-binary-tree"></a></h2>

<p dir="auto">Ta cài đặt Segment Tree bằng một cây nhị phân hoàn chỉnh có dạng như sau:</p>

<p dir="auto"><img src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/GGBmcEP.png"></p>

<p dir="auto">Trong hình vẽ trên:</p>

<ul>
  <li>Ta dùng ký hiệu <em>Chỉ số nút</em>: đoạn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 2.244em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.899em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1001.78em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="mo" id="MathJax-Span-43" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-45" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-46" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-47" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>l</mi><mo>,</mo><mi>r</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">[l, r)</script> (ký hiệu đoạn chứa biên <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-48" style="width: 0.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.29em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.23em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-49"><span class="mi" id="MathJax-Span-50" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">l</script> và không chứa biên <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-51" style="width: 0.578em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.463em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.46em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-52"><span class="mi" id="MathJax-Span-53" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.67em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">r</script>).</li>
  <li>Tại hàng cuối lưu các phần tử của mảng (đánh số từ 0) là các lá của cây.</li>
</ul>

<p dir="auto">Giả sử độ dài của mảng là lũy thừa của 2 (như 16 trong ví dụ) thì ta được cây nhị phân hoàn chỉnh. Khi đi từ dưới lên ta ghép cặp nút có chỉ số <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-54" style="width: 7.704em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.612em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1006.5em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-55"><span class="mo" id="MathJax-Span-56" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-57" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-58" style="font-family: MathJax_Main; padding-left: 0.233em;">∗</span><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">i</span><span class="mo" id="MathJax-Span-60" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-61" style="font-family: MathJax_Main; padding-left: 0.175em;">2</span><span class="mo" id="MathJax-Span-62" style="font-family: MathJax_Main; padding-left: 0.233em;">∗</span><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">i</span><span class="mo" id="MathJax-Span-64" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="mn" id="MathJax-Span-65" style="font-family: MathJax_Main; padding-left: 0.233em;">1</span><span class="mo" id="MathJax-Span-66" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>2</mn><mo>∗</mo><mi>i</mi><mo>,</mo><mn>2</mn><mo>∗</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-10">(2*i,2*i+1)</script> và tổng hợp giá trị của chúng thành giá trị của nút cha có chỉ số <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-67" style="width: 0.405em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.348em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.29em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-68"><span class="mi" id="MathJax-Span-69" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">i</script>. Bằng cách này, khi tính tổng đoạn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;11&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-70" style="width: 3.106em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.647em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.53em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-71"><span class="mo" id="MathJax-Span-72" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-73" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-75" style="font-family: MathJax_Main; padding-left: 0.175em;">11</span><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>3</mn><mo>,</mo><mn>11</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12">[3,11)</script>, ta chỉ cần cộng giá trị tại các nút 19,5,12 và 26 (các nút được in đậm) mà không cần phải cộng cả 8 giá trị trong đoạn. Cùng xem qua cách cài đặt (C++) dưới đây:</p>

<pre class="highlight" dir="auto"><code><span class="k" dir="auto">const</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">N</span> <span class="o" dir="auto">=</span> <span class="mf" dir="auto">1e5</span><span class="p" dir="auto">;</span>  <span class="c1" dir="auto">// giới hạn của mảng</span>
<span class="kt" dir="auto">int</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span>  <span class="c1" dir="auto">// kích thước mảng</span>
<span class="kt" dir="auto">int</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="mi" dir="auto">2</span> <span class="o" dir="auto">*</span> <span class="n" dir="auto">N</span><span class="p" dir="auto">];</span>

<span class="kt" dir="auto">void</span> <span class="nf" dir="auto">build</span><span class="p" dir="auto">()</span> <span class="p" dir="auto">{</span>  <span class="c1" dir="auto">// khởi tạo cây</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">n</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span> <span class="o" dir="auto">--</span><span class="n" dir="auto">i</span><span class="p" dir="auto">)</span>
    <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="o" dir="auto">|</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">];</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">void</span> <span class="nf" dir="auto">modify</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>  <span class="c1" dir="auto">// gán giá trị tại vị trí p</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span>
    <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">&gt;&gt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">^</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">];</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">int</span> <span class="nf" dir="auto">query</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>  <span class="c1" dir="auto">// tính tổng đoạn [l, r)</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">];</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">];</span>
  <span class="p" dir="auto">}</span>
  <span class="k" dir="auto">return</span> <span class="n" dir="auto">res</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">int</span> <span class="nf" dir="auto">main</span><span class="p" dir="auto">()</span> <span class="p" dir="auto">{</span>
  <span class="n" dir="auto">scanf</span><span class="p" dir="auto">(</span><span class="s" dir="auto">"%d"</span><span class="p" dir="auto">,</span> <span class="o" dir="auto">&amp;</span><span class="n" dir="auto">n</span><span class="p" dir="auto">);</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="o" dir="auto">++</span><span class="n" dir="auto">i</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">scanf</span><span class="p" dir="auto">(</span><span class="s" dir="auto">"%d"</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">t</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">n</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">i</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">build</span><span class="p" dir="auto">();</span>
  <span class="n" dir="auto">modify</span><span class="p" dir="auto">(</span><span class="mi" dir="auto">0</span><span class="p" dir="auto">,</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">printf</span><span class="p" dir="auto">(</span><span class="s" dir="auto">"%d</span><span class="se" dir="auto">\n</span><span class="s" dir="auto">"</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">query</span><span class="p" dir="auto">(</span><span class="mi" dir="auto">3</span><span class="p" dir="auto">,</span> <span class="mi" dir="auto">11</span><span class="p" dir="auto">));</span>
  <span class="k" dir="auto">return</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto">Ở trên là một ví dụ đầy đủ các thao tác. Các hàm phức tạp được tóm tắt lại trong 5 mục dưới đây.</p>

<p dir="auto">Cùng tìm hiểu cách chương trình hoạt động một cách rất hiệu quả</p>

<ol>
  <li>Ta có thể thấy được trong hình, các lá được lưu tại những nút liên tiếp với chỉ số bắt đầu từ <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-77" style="width: 0.693em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.58em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-78"><span class="mi" id="MathJax-Span-79" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.67em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">n</script>, phần tử thứ <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-80" style="width: 0.405em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.348em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.29em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-81"><span class="mi" id="MathJax-Span-82" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">i</script> tương ứng nút có chỉ số là <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-83" style="width: 2.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.187em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.19em, 2.589em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-84"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-86" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="mi" id="MathJax-Span-87" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.13em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>+</mo><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-15">i+n</script>. Do đó chúng ta có thể lưu mảng ban đầu trực tiếp vào cây đúng vị trí của từng phần tử.</li>
  <li>Trước khi thực hiện các truy vấn ta cần khởi tạo cây với độ phức tạp là <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-88" style="width: 2.474em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.129em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.01em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-89"><span class="mi" id="MathJax-Span-90" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-91" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-92" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-16">O(n)</script>. Vì nút cha luôn có chỉ số nhỏ hơn các con của nó nên ta chỉ cần duyệt qua các nút theo thứ tự giảm dần. Phép biến đổi bit trong <em>build()</em> tương ứng với phép tính <code>t[i] = t[2*i] + t[2*i+1]</code>. (Trong code trên dùng xử lý bit: <code>t[i] = t[i&lt;&lt;1] + t[i&lt;&lt;1|1]</code>).</li>
  <li>Thay đổi giá trị của một phần tử cũng khá đơn giản tốn thời gian tỉ lệ với độ cao của cây, độ phức tạp là <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-94" style="width: 4.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.198em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1004.08em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-95"><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-97" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-99"></span><span class="mo" id="MathJax-Span-100" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-102" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-103" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-17">O(\log(n))</script>. Ta chỉ cần cập nhật giá trị tại các nút cha của nút đó. Do đó chỉ cần đi lên cây biết rằng cha của nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-104" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.52em, 2.647em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-105"><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 0.87em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">p</script> là nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-107" style="width: 1.727em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.497em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1001.44em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-108"><span class="mi" id="MathJax-Span-109" style="font-family: MathJax_Math-italic;">p</span><span class="texatom" id="MathJax-Span-110"><span class="mrow" id="MathJax-Span-111"><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-113" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-19">p/2</script> (hay <code>p&gt;&gt;1</code>). Phép <code>p^1</code> biến đổi <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-114" style="width: 2.129em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.842em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1001.78em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-115"><span class="mn" id="MathJax-Span-116" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-117" style="font-family: MathJax_Main; padding-left: 0.233em;">∗</span><span class="mi" id="MathJax-Span-118" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>∗</mo><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-20">2*i</script> thành <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-119" style="width: 4.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.566em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1003.51em, 2.589em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-120"><span class="mn" id="MathJax-Span-121" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-122" style="font-family: MathJax_Main; padding-left: 0.233em;">∗</span><span class="mi" id="MathJax-Span-123" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">i</span><span class="mo" id="MathJax-Span-124" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="mn" id="MathJax-Span-125" style="font-family: MathJax_Main; padding-left: 0.233em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.13em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>∗</mo><mi>i</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-21">2*i+1</script> hay ngược lại, đó là nút con còn lại của nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-126" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.52em, 2.647em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-127"><span class="mi" id="MathJax-Span-128" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 0.87em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-22">p</script>.</li>
  <li>Tính tổng tốn độ phức tạp là <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-129" style="width: 4.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.198em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1004.08em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-130"><span class="mi" id="MathJax-Span-131" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-132" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-133" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-134" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-136" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-137" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-138" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-139" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-23">O(log(n))</script>. Để hiểu rõ hơn tính logic của thuật toán bạn có thể thử với ví dụ đoạn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;11&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-140" style="width: 3.106em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.647em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.53em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-141"><span class="mo" id="MathJax-Span-142" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-143" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-144" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-145" style="font-family: MathJax_Main; padding-left: 0.175em;">11</span><span class="mo" id="MathJax-Span-146" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>3</mn><mo>,</mo><mn>11</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-24">[3,11)</script> và thấy rằng kết quả là tổng của các nút 19, 26, 12 và 5 (theo thứ tự). Ý tưởng chung là như sau:
    <ul>
      <li>Nếu <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-147" style="width: 0.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.29em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.23em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-148"><span class="mi" id="MathJax-Span-149" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-25">l</script> (biên trái của đoạn) là lẻ (<code>if l&amp;1</code>) thì <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-150" style="width: 0.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.29em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.23em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-151"><span class="mi" id="MathJax-Span-152" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">l</script> là nút con phải của cha nó, cũng có nghĩa là đoạn cần truy vấn chứa nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-153" style="width: 0.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.29em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.23em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-154"><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">l</script> nhưng không chứa cha nó. Do đó ta cộng <code>t[l]</code> vào kết quả và nhảy đến nút bên phải của cha nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-156" style="width: 0.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.29em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.23em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-157"><span class="mi" id="MathJax-Span-158" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">l</script>: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-159" style="width: 6.325em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.463em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1005.4em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-160"><span class="mi" id="MathJax-Span-161" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-162" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mo" id="MathJax-Span-163" style="font-family: MathJax_Main; padding-left: 0.29em;">(</span><span class="mi" id="MathJax-Span-164" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-165" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="mn" id="MathJax-Span-166" style="font-family: MathJax_Main; padding-left: 0.233em;">1</span><span class="mo" id="MathJax-Span-167" style="font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-168"><span class="mrow" id="MathJax-Span-169"><span class="mo" id="MathJax-Span-170" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-171" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-29">l=(l+1)/2</script>.</li>
      <li>Nếu <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-172" style="width: 0.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.29em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.23em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-173"><span class="mi" id="MathJax-Span-174" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-30">l</script> chẵn, nó là con bên trái của cha nó và đoạn cần truy vẫn cũng chứa cha nó  (trừ khi đoạn bị giới hạn bởi biên phải), nên ta nhảy đến cha của nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-175" style="width: 0.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.29em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.23em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-176"><span class="mi" id="MathJax-Span-177" style="font-family: MathJax_Math-italic;">l</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-31">l</script>: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-178" style="width: 3.394em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.934em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.88em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-179"><span class="mi" id="MathJax-Span-180" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-181" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mi" id="MathJax-Span-182" style="font-family: MathJax_Math-italic; padding-left: 0.29em;">l</span><span class="texatom" id="MathJax-Span-183"><span class="mrow" id="MathJax-Span-184"><span class="mo" id="MathJax-Span-185" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-186" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-32">l=l/2</script>.</li>
      <li>Tương tự cho biên phải.</li>
      <li>Ta dừng khi 2 biên chạm nhau.</li>
    </ul>
  </li>
</ol>

<p dir="auto">Đoạn code hoạt động hiệu quả mà không cần đệ quy hay các phép tính khác như tìm điểm chính giữa của đoạn. Ta chỉ cần duyệt qua và tính tổng các nút trong đoạn truy vấn.</p>

<h2 class="editable"><a class="anchor" id="mảng-kích-thước-bất-kì-arbitrary-sized-array" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#m%E1%BA%A3ng-k%C3%ADch-th%C6%B0%E1%BB%9Bc-b%E1%BA%A5t-k%C3%AC-arbitrary-sized-array"></a>Mảng kích thước bất kì (Arbitrary sized array)<a class="anchor edit" id="mảng-kích-thước-bất-kì-arbitrary-sized-array" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#m%E1%BA%A3ng-k%C3%ADch-th%C6%B0%E1%BB%9Bc-b%E1%BA%A5t-k%C3%AC-arbitrary-sized-array"></a></h2>

<p dir="auto">Chúng ta đã đề cập đến các mảng có kích thước là luỹ thừa của 2, nên cây là cây nhị phân hoàn chỉnh. Phần tiếp theo có thể sẽ làm bạn hoang mang, chuẩn bị sẵn sàng nhé!</p>

<p dir="auto"><strong>Đoạn code dưới đây áp dụng cho mảng có độ dài bất kì.</strong></p>

<p dir="auto">Phần giải thích sẽ phức tạp hơn, trước hết hãy xem qua những ưu điểm của của nó:</p>

<ol>
  <li>Cây phân đoạn sử dụng bộ nhớ đúng <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-187" style="width: 2.417em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.072em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.07em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-188"><span class="mn" id="MathJax-Span-189" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-190" style="font-family: MathJax_Main; padding-left: 0.233em;">∗</span><span class="mi" id="MathJax-Span-191" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>∗</mo><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-33">2*n</script>, không phải <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-192" style="width: 2.417em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.072em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.07em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-193"><span class="mn" id="MathJax-Span-194" style="font-family: MathJax_Main;">4</span><span class="mo" id="MathJax-Span-195" style="font-family: MathJax_Main; padding-left: 0.233em;">∗</span><span class="mi" id="MathJax-Span-196" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mo>∗</mo><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-34">4*n</script> như một số cách cài đặt khác.</li>
  <li>Các phần tử của mảng được lưu trên đoạn liên tiếp bắt đầu từ chỉ số <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-197" style="width: 0.693em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.58em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-198"><span class="mi" id="MathJax-Span-199" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.67em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-35">n</script>.</li>
  <li>Tất cả thao tác đều rất đơn giản và hiệu quả.</li>
</ol>

<p dir="auto">Bạn có thể bỏ qua đoạn giải thích này và xem code để thấy tính đúng đắn của nó. Nếu hứng thú với phần giải thích, đây là hình ảnh cây của mảng có kích thước <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;13&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-200" style="width: 3.394em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.934em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.88em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-201"><span class="mi" id="MathJax-Span-202" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-203" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-204" style="font-family: MathJax_Main; padding-left: 0.29em;">13</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mn>13</mn></math></span></span><script type="math/tex" id="MathJax-Element-36">n=13</script>:</p>

<p dir="auto"><img src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/cwKpYH1.png"></p>

<p dir="auto">Nó không phải là một cây đơn lẻ nữa, nhưng là tập các cây nhị phân bao gồm:</p>

<ul>
  <li>Cây có gốc ở vị trí 2 với độ cao 4</li>
  <li>Cây có gốc ở vị trí 7 với độ cao 2</li>
  <li>Cây có gốc ở vị trí 12 với độ cao 2</li>
  <li>Cây có gốc ở vị trí 13 với độ cao 1.</li>
</ul>

<p dir="auto">Các vị trí có dấu gạch không bao giờ được sử dụng để truy vấn nên giá trị được lưu tại các nút đó không quan trọng.</p>

<p dir="auto">Các lá có độ cao khác nhau nhưng ta có thể sửa lại bằng cách cắt cây ngay trước vị trí <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;13&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-205" style="width: 1.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.98em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1000.92em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-206"><span class="mn" id="MathJax-Span-207" style="font-family: MathJax_Main;">13</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>13</mn></math></span></span><script type="math/tex" id="MathJax-Element-37">13</script> và chuyển phần phía bên phải sang bên trái. Khi đó, ta thu được cấu trúc mới có dạng giống như cây nhị phân đầy đủ (nếu chỉ quan tâm đến những thao tác ta cần thực hiện). Vì vậy độ phức tạp tương đương với độ phức tạp trên một cây nhị phân đầy đủ.</p>

<p dir="auto">Chúng ta thử xét với đoạn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;7&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-208" style="width: 2.474em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.129em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.01em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-209"><span class="mo" id="MathJax-Span-210" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-211" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-212" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-213" style="font-family: MathJax_Main; padding-left: 0.175em;">7</span><span class="mo" id="MathJax-Span-214" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>7</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-38">[0,7)</script>: Ta có <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;13&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-215" style="width: 3.106em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.647em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.59em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-216"><span class="mi" id="MathJax-Span-217" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-218" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-219" style="font-family: MathJax_Main; padding-left: 0.29em;">13</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>13</mn></math></span></span><script type="math/tex" id="MathJax-Element-39">l=13</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;20&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-220" style="width: 3.279em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.819em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.76em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-221"><span class="mi" id="MathJax-Span-222" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-223" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-224" style="font-family: MathJax_Main; padding-left: 0.29em;">20</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>=</mo><mn>20</mn></math></span></span><script type="math/tex" id="MathJax-Element-40">r=20</script></p>

<ul>
  <li>Ở lần lặp đầu:
    <ul>
      <li>
<code>l&amp;1</code>, nên ta cộng <code>t[13]</code> vào kết quả</li>
      <li>Gán <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;7&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-225" style="width: 2.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.187em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.19em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-226"><span class="mi" id="MathJax-Span-227" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-228" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-229" style="font-family: MathJax_Main; padding-left: 0.29em;">7</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>7</mn></math></span></span><script type="math/tex" id="MathJax-Element-41">l=7</script></li>
      <li>Gán <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-230" style="width: 3.279em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.819em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.76em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-231"><span class="mi" id="MathJax-Span-232" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-233" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-234" style="font-family: MathJax_Main; padding-left: 0.29em;">10</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>=</mo><mn>10</mn></math></span></span><script type="math/tex" id="MathJax-Element-42">r=10</script>.</li>
    </ul>
  </li>
  <li>Ở lần lặp thứ 2:
    <ul>
      <li>
<code>l&amp;1</code>, nên ta cộng <code>t[7]</code> vào kết quả</li>
      <li>Gán <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-235" style="width: 2.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.187em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.13em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-236"><span class="mi" id="MathJax-Span-237" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-238" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-239" style="font-family: MathJax_Main; padding-left: 0.29em;">4</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-43">l=4</script></li>
      <li>Gán <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-240" style="width: 2.704em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.302em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.24em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-241"><span class="mi" id="MathJax-Span-242" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-243" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-244" style="font-family: MathJax_Main; padding-left: 0.29em;">5</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>=</mo><mn>5</mn></math></span></span><script type="math/tex" id="MathJax-Element-44">r=5</script></li>
      <li>Lúc này các nút đã ở cùng một độ cao.</li>
    </ul>
  </li>
  <li>Ở lần lặp thứ 3:
    <ul>
      <li>
<code>r&amp;1</code> =&gt; cộng <code>t[4]</code> (<code>--r = 4</code>)</li>
      <li>Gán <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-245" style="width: 2.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.187em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.13em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-246"><span class="mi" id="MathJax-Span-247" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-248" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-249" style="font-family: MathJax_Main; padding-left: 0.29em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-45">l=2</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-250" style="width: 2.704em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.302em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.24em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-251"><span class="mi" id="MathJax-Span-252" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-253" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-254" style="font-family: MathJax_Main; padding-left: 0.29em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>=</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-46">r=2</script> và dừng lại.</li>
    </ul>
  </li>
</ul>

<h2 class="editable"><a class="anchor" id="chỉnh-sửa-trên-đoạn-truy-cập-từng-các-phần-tử-lẻ-modification-on-interval-single-element-access" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#ch%E1%BB%89nh-s%E1%BB%ADa-tr%C3%AAn-%C4%91o%E1%BA%A1n-truy-c%E1%BA%ADp-t%E1%BB%ABng-c%C3%A1c-ph%E1%BA%A7n-t%E1%BB%AD-l%E1%BA%BB-modification-on-interval-single-element-access"></a>Chỉnh sửa trên đoạn, truy cập từng các phần tử lẻ (Modification on interval, single element access)<a class="anchor edit" id="chỉnh-sửa-trên-đoạn-truy-cập-từng-các-phần-tử-lẻ-modification-on-interval-single-element-access" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#ch%E1%BB%89nh-s%E1%BB%ADa-tr%C3%AAn-%C4%91o%E1%BA%A1n-truy-c%E1%BA%ADp-t%E1%BB%ABng-c%C3%A1c-ph%E1%BA%A7n-t%E1%BB%AD-l%E1%BA%BB-modification-on-interval-single-element-access"></a></h2>

<p dir="auto">Một số người gặp khó khăn và nghĩ một cách phức tạp khi đảo các thao tác, ví dụ như:</p>

<ol>
  <li>cộng một giá trị vào tất cả phần tử trong đoạn</li>
  <li>tính giá trị của một phần tử bất kì</li>
</ol>

<p dir="auto">Tất cả những gì chúng ta phải làm trong trường hợp này là đổi đoạn code <em>modify</em>  và <em>query</em> như sau:</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">modify</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">;</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">;</span>
  <span class="p" dir="auto">}</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">int</span> <span class="nf" dir="auto">query</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">p</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span>
    <span class="n" dir="auto">res</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">];</span>
  <span class="k" dir="auto">return</span> <span class="n" dir="auto">res</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto">Nếu sau khi thực hiện tất cả các thao tác chỉnh sửa, ta muốn tính giá trị từng phần tử của dãy, ta có thể đẩy các thao tác chỉnh sửa xuống các nút lá bằng đoạn code dưới đây. Sau khi thực hiện ta chỉ cần duyệt qua các phần tử được đánh số bắt đầu từ <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-255" style="width: 0.693em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.58em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-256"><span class="mi" id="MathJax-Span-257" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.67em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-47">n</script>. Bằng cách này chúng ta đã giảm độ phức tạp từ <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;O&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-258" style="width: 5.175em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.428em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1004.31em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-259"><span class="texatom" id="MathJax-Span-260"><span class="mrow" id="MathJax-Span-261"><span class="mi" id="MathJax-Span-262" style="font-family: MathJax_Caligraphic;">O</span></span></span><span class="mo" id="MathJax-Span-263" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-264" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-265" style="font-family: MathJax_Main; padding-left: 0.175em;">log</span><span class="mo" id="MathJax-Span-266"></span><span class="texatom" id="MathJax-Span-267" style="padding-left: 0.175em;"><span class="mrow" id="MathJax-Span-268"><span class="mi" id="MathJax-Span-269" style="font-family: MathJax_Math-italic;">n</span></span></span><span class="mo" id="MathJax-Span-270" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-48">\mathcal{O}(n\log{n})</script> còn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;O&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-271" style="width: 2.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.187em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.07em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-272"><span class="texatom" id="MathJax-Span-273"><span class="mrow" id="MathJax-Span-274"><span class="mi" id="MathJax-Span-275" style="font-family: MathJax_Caligraphic;">O</span></span></span><span class="mo" id="MathJax-Span-276" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-277" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-278" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-49">\mathcal{O}(n)</script> khi sử dụng <em>build</em> thay vì <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-279" style="width: 0.693em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.58em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-280"><span class="mi" id="MathJax-Span-281" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.67em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-50">n</script> thao tác chỉnh sửa.</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">push</span><span class="p" dir="auto">()</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="o" dir="auto">++</span><span class="n" dir="auto">i</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">];</span>
    <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="o" dir="auto">|</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">];</span>
    <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span>
  <span class="p" dir="auto">}</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto"><strong>Chú ý</strong>: Đoạn code trên không thể dùng được trong trường hợp thứ tự các thao tác chỉnh sửa trên 1 phần tử ảnh hưởng đến kết quả. Ví dụ: phép gán giá trị cho 1 đoạn phần tử. Phần này sẽ được trình bày ở phần lazy propagation.</p>

<h2 class="editable"><a class="anchor" id="hàm-kết-hợp-không-có-tính-giao-hoán-non-commutative-combiner-functions" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#h%C3%A0m-k%E1%BA%BFt-h%E1%BB%A3p-kh%C3%B4ng-c%C3%B3-t%C3%ADnh-giao-ho%C3%A1n-non-commutative-combiner-functions"></a>Hàm kết hợp không có tính giao hoán (Non-commutative combiner functions)<a class="anchor edit" id="hàm-kết-hợp-không-có-tính-giao-hoán-non-commutative-combiner-functions" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#h%C3%A0m-k%E1%BA%BFt-h%E1%BB%A3p-kh%C3%B4ng-c%C3%B3-t%C3%ADnh-giao-ho%C3%A1n-non-commutative-combiner-functions"></a></h2>

<p dir="auto">Chúng ta thử xét phép kết hợp đơn giản nhất là phép cộng. Phép cộng có tính giao hoán nghĩa là thứ tự thực hiện các phép tính không quan trọng, ta có <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-282" style="width: 6.67em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.75em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1005.75em, 2.589em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-283"><span class="mi" id="MathJax-Span-284" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-285" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="mi" id="MathJax-Span-286" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">b</span><span class="mo" id="MathJax-Span-287" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mi" id="MathJax-Span-288" style="font-family: MathJax_Math-italic; padding-left: 0.29em;">b</span><span class="mo" id="MathJax-Span-289" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="mi" id="MathJax-Span-290" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">a</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.13em; border-left: 0px solid; width: 0px; height: 1.07em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mi>b</mi><mo>+</mo><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">a+b=b+a</script>. Hàm lấy <em>max</em> và <em>min</em> cũng có tính chất tương tự, chỉ thay thế các phép <code>+</code> bằng một trong hai hàm trên và ta sẽ có kết quả. Nhưng chú ý phải khởi tạo các giá trị ban đầu thành vô cực thay vì 0.</p>

<p dir="auto">Tuy nhiên, có một số trường hợp mà phép kết hợp không có tính giao hoán, ví dụ như trong bài <a href="http://codeforces.com/contest/380/problem/C">380C - Codeforces</a>, xem phân tích ở <a href="http://vnoi.info/wiki/algo/data-structures/segment-tree-extend#1-segment-tree-c%E1%BB%95-%C4%91i%E1%BB%83n_v%C3%AD-d%E1%BB%A5-1">Bài viết về Segment Tree</a>. May mắn là cách làm của ta vẫn có thể hỗ trợ phép kết hợp trong bài trên. Ta định nghĩa cấu trúc <code>Node</code> và toán tử <code>+</code> như trong bài viết trên. Trong thủ tục <em>build</em> ta dùng toán tử <code>+</code> mới định nghĩa này. Trong <em>modify</em>, ta cần đảm bảo thứ tự đúng của các nút con, biết rằng các nút con trái có chỉ số chẵn. Khi truy vấn kết quả, ta lưu ý là các nút tương ứng với nút biên trái sẽ dịch từ trái sang phải, trong khi biên phải dịch từ phải sang trái. Đoạn code như sau:</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">modify</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">,</span> <span class="k" dir="auto">const</span> <span class="n" dir="auto">Node</span><span class="o" dir="auto">&amp;</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;)</span>
    <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="o" dir="auto">|</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">];</span>
<span class="p" dir="auto">}</span>

<span class="n" dir="auto">Node</span> <span class="nf" dir="auto">query</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="n" dir="auto">Node</span> <span class="n" dir="auto">resl</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">resr</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">resl</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">resl</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">];</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">resr</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">resr</span><span class="p" dir="auto">;</span>
  <span class="p" dir="auto">}</span>
  <span class="k" dir="auto">return</span> <span class="n" dir="auto">resl</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">resr</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span></code></pre>

<h1 class="editable"><a class="anchor" id="cập-nhật-đoạn-lazy-propagation" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#c%E1%BA%ADp-nh%E1%BA%ADt-%C4%91o%E1%BA%A1n-lazy-propagation"></a>Cập nhật đoạn (Lazy propagation)<a class="anchor edit" id="cập-nhật-đoạn-lazy-propagation" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#c%E1%BA%ADp-nh%E1%BA%ADt-%C4%91o%E1%BA%A1n-lazy-propagation"></a></h1>

<p dir="auto">Tiếp theo, chúng ta tìm hiểu về một kĩ thuật dùng để thực hiện cả truy vấn trên đoạn và chỉnh sửa trên đoạn. Đầu tiên ta cần định nghĩa thêm biến:</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">int</span> <span class="n" dir="auto">h</span> <span class="o" dir="auto">=</span> <span class="k" dir="auto">sizeof</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span><span class="p" dir="auto">)</span> <span class="o" dir="auto">*</span> <span class="mi" dir="auto">8</span> <span class="o" dir="auto">-</span> <span class="n" dir="auto">__builtin_clz</span><span class="p" dir="auto">(</span><span class="n" dir="auto">n</span><span class="p" dir="auto">);</span>
<span class="kt" dir="auto">int</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">N</span><span class="p" dir="auto">];</span></code></pre>

<p dir="auto"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-291" style="width: 0.693em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.58em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-292"><span class="mi" id="MathJax-Span-293" style="font-family: MathJax_Math-italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-52">h</script> là độ cao của cây và là bit cao nhất trong <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-294" style="width: 0.693em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.578em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.58em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-295"><span class="mi" id="MathJax-Span-296" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.67em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-53">n</script>. <code>d[i]</code> là thao tác được lưu lại để truyền cho các nút con của nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-297" style="width: 0.405em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.348em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.29em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-298"><span class="mi" id="MathJax-Span-299" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">i</script> khi cần thiết (xem ví dụ để hiểu rõ hơn, hoặc đọc thêm <a href="http://vnoi.info/wiki/algo/data-structures/segment-tree-extend#2-lazy-propagation">Lazy Propagation trong bài viết về Segment Tree</a>). Kích thước của mảng là <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-300" style="width: 1.037em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.865em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.87em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-301"><span class="mi" id="MathJax-Span-302" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">N</script> vì ta không cần lưu thông tin này tại các nút lá (do các nút lá không có con). Do đó ta cần tất cả là <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-303" style="width: 2.761em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.359em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.36em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-304"><span class="mn" id="MathJax-Span-305" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-306" style="font-family: MathJax_Main; padding-left: 0.233em;">∗</span><span class="mi" id="MathJax-Span-307" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mo>∗</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-56">3*N</script> bộ nhớ sử dụng.</p>

<p dir="auto">Ở trên ta nói <code>t[i]</code> là giá trị tương ứng với đoạn của nó. Nhưng bây giờ điều này không hoàn toàn đúng:</p>

<ul>
  <li>Ta phải thực hiện các thao tác được lưu lại vào <code>d[i]</code> trên đường đi từ nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-308" style="width: 0.405em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.348em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.29em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-309"><span class="mi" id="MathJax-Span-310" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-57">i</script> đến gốc của cây (tổ tiên của nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-311" style="width: 0.405em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.348em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.29em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-312"><span class="mi" id="MathJax-Span-313" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-58">i</script>).</li>
  <li>Khi cài đặt, ta giả sử là giá trị tại <code>t[i]</code> đã bao gồm <code>d[i]</code>, nên đường đi bắt đầu từ cha của <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-314" style="width: 0.405em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.348em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.29em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-315"><span class="mi" id="MathJax-Span-316" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-59">i</script>.</li>
</ul>

<p dir="auto">Quay trở lại ví dụ đầu tiên với đoạn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;11&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-317" style="width: 3.106em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.647em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.53em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-318"><span class="mo" id="MathJax-Span-319" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-320" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-321" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-322" style="font-family: MathJax_Main; padding-left: 0.175em;">11</span><span class="mo" id="MathJax-Span-323" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>3</mn><mo>,</mo><mn>11</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-60">[3,11)</script>, nhưng bây giờ ta sẽ chỉnh sửa tất giá trị của tất cả phần tử trong đoạn. Để làm điều này, ta sẽ chỉnh sửa <code>t[i]</code> và <code>d[i]</code> tại các nút: 19, 5, 12 và 26.</p>

<p dir="auto">Sau đó, khi cần tìm giá trị ở một nút, ví dụ như nút 22, ta cần phải truyền các chỉnh sửa từ nút 5 xuống. Chú ý rằng những thay đổi có thể ảnh hưởng đến các giá trị <code>t[i]</code> trên cây như sau: nút 19 ảnh hưởng đến nút 9, 4, 2 và 1; nút 5 ảnh hưởng đến nút 2 và 1. Lập luận tiếp theo rất quan trọng đến độ phức tạp của các thao tác chỉnh sửa:</p>

<p dir="auto"><strong>Chỉnh sửa trên đoạn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-324" style="width: 2.244em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.899em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1001.78em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-325"><span class="mo" id="MathJax-Span-326" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-327" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-328" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-329" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-330" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>l</mi><mo>,</mo><mi>r</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-61">[l,r)</script> chỉ ảnh hưởng giá trị <code>t[i]</code> của các nút cha của nút lá ở biên: <code>l+n</code> và <code>r+n-1</code> (ngoại trừ các giá trị lưu chính đoạn của nó - những giá trị duyệt đến trong vòng lặp <em>for</em>).</strong></p>

<p dir="auto"><strong>Chứng minh</strong></p>

<ul>
  <li>Khi duyệt biên trái, các nút ta chỉnh sửa trong vòng lặp luôn là con phải của cha nó. Do đó tất cả các chỉnh sửa trước đó đều là trên cây con của nút trái của nút cha. Nói cách khác ta có thể duyệt nút cha thay vì cả hai con của nó. Điều này có nghĩa là cha trực tiếp hiện tại cũng là cha của lá <code>l+n</code>.</li>
  <li>Chứng minh tương tự cho biên phải.</li>
</ul>

<p dir="auto">Mời các bạn cùng xem qua những ví dụ cụ thể.</p>

<h2 class="editable"><a class="anchor" id="tăng-giá-trị-phần-tử-truy-vấn-tìm-giá-trị-max-increment-modifications-queries-for-maximum" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#t%C4%83ng-gi%C3%A1-tr%E1%BB%8B-ph%E1%BA%A7n-t%E1%BB%AD-truy-v%E1%BA%A5n-t%C3%ACm-gi%C3%A1-tr%E1%BB%8B-max-increment-modifications-queries-for-maximum"></a>Tăng giá trị phần tử, truy vấn tìm giá trị max (Increment modifications, queries for maximum)<a class="anchor edit" id="tăng-giá-trị-phần-tử-truy-vấn-tìm-giá-trị-max-increment-modifications-queries-for-maximum" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#t%C4%83ng-gi%C3%A1-tr%E1%BB%8B-ph%E1%BA%A7n-t%E1%BB%AD-truy-v%E1%BA%A5n-t%C3%ACm-gi%C3%A1-tr%E1%BB%8B-max-increment-modifications-queries-for-maximum"></a></h2>

<p dir="auto">Đây có lẽ là trường hợp đơn giản nhất. Code dưới đây không phổ biến và không phải là cách tối ưu nhất, nhưng là một cách tốt để bắt đầu.</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">p</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">)</span>
    <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">void</span> <span class="nf" dir="auto">build</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">while</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span>
    <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">max</span><span class="p" dir="auto">(</span><span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">],</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="o" dir="auto">|</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">])</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">];</span>
  <span class="p" dir="auto">}</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">void</span> <span class="nf" dir="auto">push</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">s</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">h</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">s</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span> <span class="o" dir="auto">--</span><span class="n" dir="auto">s</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="kt" dir="auto">int</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">p</span> <span class="o" dir="auto">&gt;&gt;</span> <span class="n" dir="auto">s</span><span class="p" dir="auto">;</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">!=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
      <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]);</span>
      <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="o" dir="auto">|</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]);</span>
      <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span>
    <span class="p" dir="auto">}</span>
  <span class="p" dir="auto">}</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">void</span> <span class="nf" dir="auto">inc</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">l0</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r0</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">);</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">);</span>
  <span class="p" dir="auto">}</span>
  <span class="n" dir="auto">build</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l0</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">build</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r0</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">int</span> <span class="nf" dir="auto">query</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">=</span> <span class="o" dir="auto">-</span><span class="mf" dir="auto">2e9</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">max</span><span class="p" dir="auto">(</span><span class="n" dir="auto">res</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">]);</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">max</span><span class="p" dir="auto">(</span><span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">],</span> <span class="n" dir="auto">res</span><span class="p" dir="auto">);</span>
  <span class="p" dir="auto">}</span>
  <span class="k" dir="auto">return</span> <span class="n" dir="auto">res</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto">Tìm hiểu lần lượt từng thủ tục một. Ba thủ tục đầu tiên không thực sự cần phải biết:</p>

<ol>
  <li>Mỗi nút chứa 2 biến, rất hữu ích khi viết một thủ tục <em>apply</em> những thay đổi cho cả hai. <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-331" style="width: 2.876em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.474em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1002.47em, 2.704em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-332"><span class="mi" id="MathJax-Span-333" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-334" style="font-family: MathJax_Main; padding-left: 0.29em;">&lt;</span><span class="mi" id="MathJax-Span-335" style="font-family: MathJax_Math-italic; padding-left: 0.29em;">n</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo>&lt;</mo><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">p<n</script> để kiểm tra <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-336" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.52em, 2.647em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-337"><span class="mi" id="MathJax-Span-338" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 0.87em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-63">p</script> không phải là lá. Một tính chất quan trọng là các thao tác khi chúng ta cùng tăng giá trị của các phần tử trong một đoạn thì giá trị max cũng tăng tương ứng.</li>
  <li>
<em>build</em> cập nhật tất cả các cha của nút cho trước.</li>
  <li>
<em>push</em> truyền tất cả các thay đổi từ  tất cả nút cha của nút hiện tại xuống  bắt đầu từ gốc. Những nút cha là tiền tố trong biểu diễn nhị phân của của <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-339" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.52em, 2.647em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-340"><span class="mi" id="MathJax-Span-341" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 0.87em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-64">p</script>, do đó ta dùng phép dịch bit để tính toán.</li>
</ol>

<p dir="auto">Tiếp theo là những thủ tục chính:</p>

<ol>
  <li>Như đã giải thích ở trên, ta thực hiện các thay đổi vòng lặp quen thuộc để cập nhật tất cả và thêm một việc là gọi hàm <em>build</em>.</li>
  <li>Để trả lời truy vấn, ta cũng sử dụng vòng lặp như cũ, tuy nhiên trước đó cần phải đẩy các thay đổi đến những nút sẽ được sử dụng. Tương tự như <em>build</em>, như vậy là đủ để đẩy các thay đổi từ các nút cha của những nút lá ở biên.</li>
</ol>

<p dir="auto">Dễ dàng nhận thấy tất cả các thao tác trên tốn độ phức tạp <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-342" style="width: 4.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.198em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1004.08em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-343"><span class="mi" id="MathJax-Span-344" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-345" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-346" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-347" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-348" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-349" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-350" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-351" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-352" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-65">O(log(n))</script>.</p>

<p dir="auto">Đây là trường hợp đơn giản nhất vì 2 lý do:</p>

<ol>
  <li>thứ tự các thay đổi không làm ảnh hưởng kết quả.</li>
  <li>khi cập nhật một nút, ta không cần biết độ dài của đoạn nó đại diện.</li>
</ol>

<p dir="auto">Tiếp theo ta sẽ ứng dụng các phương pháp trong một ví dụ tiếp theo.</p>

<h2 class="editable"><a class="anchor" id="gán-giá-trị-mới-cho-phần-tử-truy-vấn-tổng-assignment-modifications-sum-queries" href="https://vnoi.info/wiki/translate/codeforces/Efficient-and-easy-segment-trees.md#g%C3%A1n-gi%C3%A1-tr%E1%BB%8B-m%E1%BB%9Bi-cho-ph%E1%BA%A7n-t%E1%BB%AD-truy-v%E1%BA%A5n-t%E1%BB%95ng-assignment-modifications-sum-queries"></a>Gán giá trị mới cho phần tử, truy vấn tổng (Assignment modifications, sum queries)<a class="anchor edit" id="gán-giá-trị-mới-cho-phần-tử-truy-vấn-tổng-assignment-modifications-sum-queries" href="https://vnoi.info/wiki/gollum/edit/translate/codeforces/Efficient-and-easy-segment-trees.md#g%C3%A1n-gi%C3%A1-tr%E1%BB%8B-m%E1%BB%9Bi-cho-ph%E1%BA%A7n-t%E1%BB%AD-truy-v%E1%BA%A5n-t%E1%BB%95ng-assignment-modifications-sum-queries"></a></h2>

<p dir="auto">Ví dụ này dựa trên <a href="http://acm.timus.ru/problem.aspx?space=1&amp;num=2042">Timus 2042</a></p>

<p dir="auto">Chúng ta lại bắt đầu từ các hàm trợ giúp. Ở đây ta có nhiều hàm hơn:</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">calc</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">==</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">+</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="o" dir="auto">|</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">];</span>
  <span class="k" dir="auto">else</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">*</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">void</span> <span class="nf" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">p</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">value</span> <span class="o" dir="auto">*</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">p</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">p</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto">Đây là những hàm đơn giản có độ phức tạp <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-353" style="width: 2.417em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.072em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1001.96em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-354"><span class="mi" id="MathJax-Span-355" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-356" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-357" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-358" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-66">O(1)</script> dùng để tính giá trị tại nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-359" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.52em, 2.647em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-360"><span class="mi" id="MathJax-Span-361" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 0.87em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-67">p</script> và thực hiện một thay đổi cho nút. Có 2 điều cần giải thích:</p>

<ol>
  <li>Ta kiểm tra <code>d[p] == 0</code> vì 0 là một giá trị mà không bao giờ được dùng trong các thay đổi. Trong trường hợp không có giá trị nào như vậy, ta buộc phải dùng thêm mảng đánh dấu.</li>
  <li>Ta có thêm một tham số <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-362" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.52em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-363"><span class="mi" id="MathJax-Span-364" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-68">k</script>, chứa độ dài của đoạn thuộc nút <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-365" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.67em, 1000.52em, 2.647em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-366"><span class="mi" id="MathJax-Span-367" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 0.87em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-69">p</script>. Tham số <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-368" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.52em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-369"><span class="mi" id="MathJax-Span-370" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-70">k</script> sẽ được giữ nguyên ý nghĩa trong cả đoạn code. Có thể nhận thấy ta không thể tính tổng nếu không có tham số này. Ta có thể tính trước giá trị <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-371" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.52em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-372"><span class="mi" id="MathJax-Span-373" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-71">k</script> cho tất cả các nút hay suy ra từ chỉ số của nút trên đường đi, nhưng ta sẽ tìm hiểu một cách khác không cần phải sử dụng thêm bộ nhớ hay tính toán.</li>
</ol>

<p dir="auto">Tiếp theo ta cần chỉnh sử lại <em>build</em> và <em>push</em>. Lưu ý rằng ta đang có 2 phiên bản: một được giới thiệu trước duyệt qua toàn bộ cây trong <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-374" style="width: 2.474em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.129em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.01em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-375"><span class="mi" id="MathJax-Span-376" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-377" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-378" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-379" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-72">O(n)</script>, một được sử dụng trong ví dụ trước mà chỉ duyệt các nút cha của một nút là trong <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-380" style="width: 4.888em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.198em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1004.08em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-381"><span class="mi" id="MathJax-Span-382" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-383" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-384" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-385" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-386" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-387" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-388" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-389" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-390" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-73">O(log(n))</script>. Ta có thể dễ dàng tích hợp thêm các chức năng mới vào cùng một thủ tục.</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">build</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">2</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="o" dir="auto">-</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">&lt;&lt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span>
    <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">&gt;=</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">;</span> <span class="o" dir="auto">--</span><span class="n" dir="auto">i</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">calc</span><span class="p" dir="auto">(</span><span class="n" dir="auto">i</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
  <span class="p" dir="auto">}</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">void</span> <span class="nf" dir="auto">push</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">s</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">h</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">1</span> <span class="o" dir="auto">&lt;&lt;</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">h</span><span class="o" dir="auto">-</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="o" dir="auto">-</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">s</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span> <span class="o" dir="auto">--</span><span class="n" dir="auto">s</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span>
    <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;</span> <span class="n" dir="auto">s</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">i</span> <span class="o" dir="auto">&lt;=</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;</span> <span class="n" dir="auto">s</span><span class="p" dir="auto">;</span> <span class="o" dir="auto">++</span><span class="n" dir="auto">i</span><span class="p" dir="auto">)</span> <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">!=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
      <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">],</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
      <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="n" dir="auto">i</span><span class="o" dir="auto">&lt;&lt;</span><span class="mi" dir="auto">1</span><span class="o" dir="auto">|</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">],</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
      <span class="n" dir="auto">d</span><span class="p" dir="auto">[</span><span class="n" dir="auto">i</span><span class="p" dir="auto">]</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span>
    <span class="p" dir="auto">}</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto">Cả hai thủ tục này thực hiện trên đoạn bất kỳ với đô phức tạp <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-391" style="width: 9.313em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.991em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1007.88em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-392"><span class="mi" id="MathJax-Span-393" style="font-family: MathJax_Math-italic;">O</span><span class="mo" id="MathJax-Span-394" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-395" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-396" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-397" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-398" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-399" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-400" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-401" style="font-family: MathJax_Main; padding-left: 0.233em;">+</span><span class="texatom" id="MathJax-Span-402" style="padding-left: 0.233em;"><span class="mrow" id="MathJax-Span-403"><span class="mo" id="MathJax-Span-404" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-405" style="font-family: MathJax_Math-italic;">r</span><span class="mo" id="MathJax-Span-406" style="font-family: MathJax_Main; padding-left: 0.233em;">−</span><span class="mi" id="MathJax-Span-407" style="font-family: MathJax_Math-italic; padding-left: 0.233em;">l</span><span class="texatom" id="MathJax-Span-408"><span class="mrow" id="MathJax-Span-409"><span class="mo" id="MathJax-Span-410" style="font-family: MathJax_Main;">|</span></span></span><span class="mo" id="MathJax-Span-411" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>r</mi><mo>−</mo><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-74">O(log(n)+|r-l|)</script>. Nếu muốn biến đổi một đoạn trên cây, ta có thể viết như sau:</p>

<pre class="highlight" dir="auto"><code><span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">);</span>
<span class="p" dir="auto">...</span>  <span class="c1" dir="auto">// thức hiện bất kì thứ gì lên các phần tử trong đoạn [l, r)</span>
<span class="n" dir="auto">build</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">);</span></code></pre>

<p dir="auto">Cùng tìm hiểu cách  hoạt động. Trước tiên, chú ý là ta đã thay đổi thành đoạn <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-412" style="width: 2.244em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.899em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1001.78em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-413"><span class="mo" id="MathJax-Span-414" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-415" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-416" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-417" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-418" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>l</mi><mo>,</mo><mi>r</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-75">[l,r)</script> thành <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-419" style="width: 2.072em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.784em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1001.67em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-420"><span class="mo" id="MathJax-Span-421" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-422" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-423" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-424" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-425" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>l</mi><mo>,</mo><mi>r</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-76">[l,r]</script> khi thực hiện <code>r+=n-1</code> để tính chính xác các nút cha. Do ta duyệt cây theo từng tầng, nên có thể dễ dàng duy trì độ dài của đoạn hiện tại, luôn luôn là lũy thừa của <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-426" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1000.46em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-427"><span class="mn" id="MathJax-Span-428" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-77">2</script>. <em>build</em> đi từ dưới lên trên, do đó ban đầu khởi tạo <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-429" style="width: 2.761em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.359em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.3em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-430"><span class="mi" id="MathJax-Span-431" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-432" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-433" style="font-family: MathJax_Main; padding-left: 0.29em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo>=</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-78">k=2</script> (không phải 1 vì ta không tính tại nút lá nhưng bắt đầu từ cha trực tiếp của nó) và nhân đôi <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-434" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.52em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-435"><span class="mi" id="MathJax-Span-436" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-79">k</script> tại mỗi tầng. <em>push</em> đi từ trên xuống dưới, do đó giá trị ban đầu của <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-437" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.52em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-438"><span class="mi" id="MathJax-Span-439" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-80">k</script> phụ thuộc vào độ cao của cây và bị chia <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-440" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1000.46em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-441"><span class="mn" id="MathJax-Span-442" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-81">2</script> sau mỗi tầng.</p>

<p dir="auto">Các thủ tục chính không thay đổi nhiều so với ví dụ trước, nhưng <em>modify</em> có 2 điều đáng chú ý:</p>

<ol>
  <li>Do thứ tự của các phép biến đổi là quan trọng, ta cần phải đảm bảo không có những thay biến đổi cũ trên đường đi từ gốc đến tất cả các nút mà ta sẽ cập nhật. Điều này được thực hiện khi gọi <em>push</em> đầu tiên trong <em>query</em>.</li>
  <li>Ta cần phải duy trì giá trị của <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-443" style="width: 0.635em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.52em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1000.52em, 2.474em, -999.997em); top: -2.296em; left: 0em;"><span class="mrow" id="MathJax-Span-444"><span class="mi" id="MathJax-Span-445" style="font-family: MathJax_Math-italic;">k</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-82">k</script>.</li>
</ol>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">modify</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">value</span> <span class="o" dir="auto">==</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">)</span> <span class="k" dir="auto">return</span><span class="p" dir="auto">;</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">+</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">);</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">l0</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r0</span> <span class="o" dir="auto">=</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">&lt;&lt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
  <span class="p" dir="auto">}</span>
  <span class="n" dir="auto">build</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l0</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">l0</span> <span class="o" dir="auto">+</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">build</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r0</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r0</span><span class="p" dir="auto">);</span>
<span class="p" dir="auto">}</span>

<span class="kt" dir="auto">int</span> <span class="nf" dir="auto">query</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">+</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">);</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">];</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">res</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">t</span><span class="p" dir="auto">[</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">];</span>
  <span class="p" dir="auto">}</span>
  <span class="k" dir="auto">return</span> <span class="n" dir="auto">res</span><span class="p" dir="auto">;</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto">Để ý ta thấy ta thực hiện 3 lần đi trong <em>modify</em> gần như trên cùng các nút: 1 đi xuống dưới cây trong <em>push</em>, rồi 2 đi lên cây. Ta có thể bỏ lần cuối cùng chỉ và tính các giá trị mới khi cần thiết, nhưng code sẽ trở nên phức tạp hơn:</p>

<pre class="highlight" dir="auto"><code><span class="kt" dir="auto">void</span> <span class="nf" dir="auto">modify</span><span class="p" dir="auto">(</span><span class="kt" dir="auto">int</span> <span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="kt" dir="auto">int</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
  <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">value</span> <span class="o" dir="auto">==</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">)</span> <span class="k" dir="auto">return</span><span class="p" dir="auto">;</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">+</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">);</span>
  <span class="n" dir="auto">push</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">);</span>
  <span class="kt" dir="auto">bool</span> <span class="n" dir="auto">cl</span> <span class="o" dir="auto">=</span> <span class="nb" dir="auto">false</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">cr</span> <span class="o" dir="auto">=</span> <span class="nb" dir="auto">false</span><span class="p" dir="auto">;</span>
  <span class="kt" dir="auto">int</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">;</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">+=</span> <span class="n" dir="auto">n</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&lt;</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">&lt;&lt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">cl</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">calc</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span> <span class="o" dir="auto">-</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">cr</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">calc</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="o" dir="auto">++</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">),</span> <span class="n" dir="auto">cl</span> <span class="o" dir="auto">=</span> <span class="nb" dir="auto">true</span><span class="p" dir="auto">;</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="o" dir="auto">&amp;</span><span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">apply</span><span class="p" dir="auto">(</span><span class="o" dir="auto">--</span><span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">value</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">),</span> <span class="n" dir="auto">cr</span> <span class="o" dir="auto">=</span> <span class="nb" dir="auto">true</span><span class="p" dir="auto">;</span>
  <span class="p" dir="auto">}</span>
  <span class="k" dir="auto">for</span> <span class="p" dir="auto">(</span><span class="o" dir="auto">--</span><span class="n" dir="auto">l</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;</span> <span class="mi" dir="auto">0</span><span class="p" dir="auto">;</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">r</span> <span class="o" dir="auto">&gt;&gt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span> <span class="o" dir="auto">&lt;&lt;=</span> <span class="mi" dir="auto">1</span><span class="p" dir="auto">)</span> <span class="p" dir="auto">{</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">cl</span><span class="p" dir="auto">)</span> <span class="n" dir="auto">calc</span><span class="p" dir="auto">(</span><span class="n" dir="auto">l</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
    <span class="k" dir="auto">if</span> <span class="p" dir="auto">(</span><span class="n" dir="auto">cr</span> <span class="o" dir="auto">&amp;&amp;</span> <span class="p" dir="auto">(</span><span class="o" dir="auto">!</span><span class="n" dir="auto">cl</span> <span class="o" dir="auto">||</span> <span class="n" dir="auto">l</span> <span class="o" dir="auto">!=</span> <span class="n" dir="auto">r</span><span class="p" dir="auto">))</span> <span class="n" dir="auto">calc</span><span class="p" dir="auto">(</span><span class="n" dir="auto">r</span><span class="p" dir="auto">,</span> <span class="n" dir="auto">k</span><span class="p" dir="auto">);</span>
  <span class="p" dir="auto">}</span>
<span class="p" dir="auto">}</span></code></pre>

<p dir="auto">Biến boolean dùng để đánh dấu xem ta đã thực hiện biến đổi nào ở bên trái và ở bên phải. Xem một ví dụ:</p>

<p dir="auto"><img src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/CG6aftV.png"></p>

<p dir="auto">Gọi <em>modify</em> trên <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;13&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-446" style="width: 3.106em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.647em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.44em, 1002.53em, 2.761em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-447"><span class="mo" id="MathJax-Span-448" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-449" style="font-family: MathJax_Main;">4</span><span class="mo" id="MathJax-Span-450" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-451" style="font-family: MathJax_Main; padding-left: 0.175em;">13</span><span class="mo" id="MathJax-Span-452" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.27em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>4</mn><mo>,</mo><mn>13</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-83">[4,13)</script>:</p>

<ol>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;20&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;29&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-453" style="width: 6.899em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.922em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1005.87em, 2.704em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-454"><span class="mi" id="MathJax-Span-455" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-456" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-457" style="font-family: MathJax_Main; padding-left: 0.29em;">20</span><span class="mo" id="MathJax-Span-458" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-459" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-460" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-461" style="font-family: MathJax_Main; padding-left: 0.29em;">29</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.137em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>20</mn><mo>,</mo><mi>r</mi><mo>=</mo><mn>29</mn></math></span></span><script type="math/tex" id="MathJax-Element-84">l=20, r=29</script>, gọi <em>apply(28)</em>;</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;14&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-462" style="width: 6.899em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.922em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1005.87em, 2.704em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-463"><span class="mi" id="MathJax-Span-464" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-465" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-466" style="font-family: MathJax_Main; padding-left: 0.29em;">10</span><span class="mo" id="MathJax-Span-467" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-468" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-469" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-470" style="font-family: MathJax_Main; padding-left: 0.29em;">14</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.137em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>10</mn><mo>,</mo><mi>r</mi><mo>=</mo><mn>14</mn></math></span></span><script type="math/tex" id="MathJax-Element-85">l=10, r=14</script>, gọi <em>calc(14)</em> - nút đầu tiên về bên phải của đoạn hiện tại chính là cha của nút được biến đổi cuối cùng;</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;7&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-471" style="width: 5.75em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.945em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1004.95em, 2.704em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-472"><span class="mi" id="MathJax-Span-473" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-474" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-475" style="font-family: MathJax_Main; padding-left: 0.29em;">5</span><span class="mo" id="MathJax-Span-476" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-477" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-478" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-479" style="font-family: MathJax_Main; padding-left: 0.29em;">7</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.137em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>5</mn><mo>,</mo><mi>r</mi><mo>=</mo><mn>7</mn></math></span></span><script type="math/tex" id="MathJax-Element-86">l=5, r=7</script>, gọi <em>calc(7)</em> và tiếp đó là <em>apply(5)</em> và <em>apply(6)</em>;</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-480" style="width: 5.75em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.945em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1004.89em, 2.704em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-481"><span class="mi" id="MathJax-Span-482" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-483" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-484" style="font-family: MathJax_Main; padding-left: 0.29em;">3</span><span class="mo" id="MathJax-Span-485" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-486" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-487" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-488" style="font-family: MathJax_Main; padding-left: 0.29em;">3</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.137em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>3</mn><mo>,</mo><mi>r</mi><mo>=</mo><mn>3</mn></math></span></span><script type="math/tex" id="MathJax-Element-87">l=3, r=3</script>, vòng lặp đầu tiên kết thúc.</li>
</ol>

<p dir="auto">Bây giờ bạn có thể hiểu lý do thực hiện <code>--l</code>, vì ta vẫn cần phải tính giá trị mới tại các nút 2, 3 và 1. Điều kiện kết thúc là <code>r&gt;0</code> bởi vì có thể <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-489" style="width: 5.75em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.945em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1004.89em, 2.704em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-490"><span class="mi" id="MathJax-Span-491" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-492" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-493" style="font-family: MathJax_Main; padding-left: 0.29em;">1</span><span class="mo" id="MathJax-Span-494" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-495" style="font-family: MathJax_Math-italic; padding-left: 0.175em;">r</span><span class="mo" id="MathJax-Span-496" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-497" style="font-family: MathJax_Main; padding-left: 0.29em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.263em; border-left: 0px solid; width: 0px; height: 1.137em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>r</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-88">l=1, r=1</script> sau vòng lặp đầu tiên, do đó ta cần phải cập nhật cho gốc, nhưng <code>--l</code> dẫn đến <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-498" style="width: 2.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.187em; height: 0px; font-size: 116%;"><span style="position: absolute; clip: rect(1.497em, 1002.13em, 2.532em, -999.997em); top: -2.353em; left: 0em;"><span class="mrow" id="MathJax-Span-499"><span class="mi" id="MathJax-Span-500" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-501" style="font-family: MathJax_Main; padding-left: 0.29em;">=</span><span class="mn" id="MathJax-Span-502" style="font-family: MathJax_Main; padding-left: 0.29em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.359em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.937em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-89">l=0</script>.</p>

<p dir="auto">So sánh với cách thực hiện cũ, ta đã giảm được những lần gọi không cần thiết <em>calc(10)</em>, <em>calc(5)</em> và lặp <em>calc(1)</em>.</p>

	    </div>
	  </div>
	  </div>

	</div>


	<div id="footer" class="pt-4">
	</div>

	
</div>

<hr><br>
  <div class="fb-like fb_iframe_widget" data-href="/wiki/translate/codeforces/Efficient-and-easy-segment-trees" data-width="1080" data-layout="button_count" data-action="like" data-size="large" data-show-faces="true" data-share="true" fb-xfbml-state="rendered" fb-iframe-plugin-query="action=like&amp;app_id=449532395210446&amp;container_width=1012&amp;href=https%3A%2F%2Fvnoi.info%2Fwiki%2Ftranslate%2Fcodeforces%2FEfficient-and-easy-segment-trees&amp;layout=button_count&amp;locale=en_GB&amp;sdk=joey&amp;share=true&amp;show_faces=true&amp;size=large&amp;width=1080"><span style="vertical-align: bottom; width: 148px; height: 28px;"><iframe name="f624e23e2d795c" width="1080px" height="1000px" data-testid="fb:like Facebook Social Plugin" title="fb:like Facebook Social Plugin" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" allow="encrypted-media" src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/like.html" style="border: none; visibility: visible; width: 148px; height: 28px;" class=""></iframe></span></div>
  <div class="fb-save fb_iframe_widget" data-uri="/wiki/translate/codeforces/Efficient-and-easy-segment-trees" data-size="large" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=449532395210446&amp;container_width=1012&amp;locale=en_GB&amp;sdk=joey&amp;size=large&amp;uri=https%3A%2F%2Fvnoi.info%2Fwiki%2Ftranslate%2Fcodeforces%2FEfficient-and-easy-segment-trees"><span style="vertical-align: bottom; width: 153px; height: 28px;"><iframe name="f658a1fde4c5cc" width="1000px" height="1000px" data-testid="fb:save Facebook Social Plugin" title="fb:save Facebook Social Plugin" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" allow="encrypted-media" src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/save.html" style="border: none; visibility: visible; width: 153px; height: 28px;" class=""></iframe></span></div>
  <br>
  <div class="fb-comments fb_iframe_widget fb_iframe_widget_fluid_desktop" data-href="vnoi.info//wiki/translate/codeforces/Efficient-and-easy-segment-trees" data-width="100%" data-numposts="5" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=449532395210446&amp;container_width=1012&amp;height=100&amp;href=http%3A%2F%2Fvnoi.info%2F%2Fwiki%2Ftranslate%2Fcodeforces%2FEfficient-and-easy-segment-trees&amp;locale=en_GB&amp;numposts=5&amp;sdk=joey&amp;version=v2.7&amp;width=" style="width: 100%;"><span style="vertical-align: bottom; width: 100%; height: 254px;"><iframe name="f1d8ab3e699aca4" width="1000px" height="100px" data-testid="fb:comments Facebook Social Plugin" title="fb:comments Facebook Social Plugin" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" allow="encrypted-media" src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/comments.html" style="border: none; visibility: visible; width: 100%; height: 254px;" class=""></iframe></span></div>

</div>




<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; min-width: 0px; max-width: none; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Caligraphic, sans-serif;"></div></div><iframe id="nr-ext-rsicon" style="position: absolute; display: none; width: 50px; height: 50px; z-index: 2147483647; border-style: none; background: transparent;" src="./Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)_files/saved_resource.html"></iframe><div id="eJOY__extension_root" class="eJOY__extension_root_class" style="all: unset;"></div></body></html>